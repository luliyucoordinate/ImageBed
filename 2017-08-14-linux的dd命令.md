---
layout: post
title: 	linux的dd命令
category : linux
tags : [linux, dd]
stickie: true
---

dd命令
---

 - 语法格式

`dd   [option] `

 - dd指令选项详解

`if=file`：输入文件名，缺省为标准输入  
`of=file`：输出文件名，缺省为标准输出  
`ibs=bytes`：一次读入 bytes 个字节（即一个块大小为 bytes 个字节）  
`obs=bytes`：一次写 bytes 个字节（即一个块大小为 bytes 个字节）  
`bs=bytes`：同时设置读写块的大小为 bytes ，可代替 ibs 和 obs  
`cbs=bytes`：一次转换 bytes 个字节，即转换缓冲区大小  
`skip=blocks`：从输入文件开头跳过 blocks 个块后再开始复制  
`seek=blocks`：从输出文件开头跳过 blocks 个块后再开始复制。（通常只有当输出文件是磁盘或磁带时才有效）  
`count=blocks`：仅拷贝 blocks 个块，块大小等于 ibs 指定的字节数  
`conv=ASCII`：把EBCDIC码转换为ASCIl码。   
`conv=ebcdic`：把ASCIl码转换为EBCDIC码。   
`conv=ibm`：把ASCIl码转换为alternate EBCDIC码。   
`conv=block`：把变动位转换成固定字符。   
`conv=ublock`：把固定位转换成变动位。   
`conv=ucase`：把字母由小写转换为大写。   
`conv=lcase`：把字母由大写转换为小写。   
`conv=notrunc`：不截短输出文件。   
`conv=swab`：交换每一对输入字节。   
`conv=noerror`：出错时不停止处理。   
`conv=sync`：把每个输入记录的大小都调到ibs的大小（用NUL填充）。   
`iflag=FLAGS`：指定读的方式FLAGS，参见“FLAGS参数说明”  
`oflag=FLAGS`：指定写的方式FLAGS，参见“FLAGS参数说明”  

 - FLAGS参数说明：

append -append  mode  (makes  sense  only  for output; conv=notrunc sug-gested)
`direct`：读写数据采用直接IO方式；  
`directory`：读写失败除非是directory；  
`dsync`：读写数据采用同步IO；  
`sync`：同上，但是针对是元数据  
`fullblock`：堆积满block（accumulate full blocks of input ）(iflag only)；  
`nonblock`：读写数据采用非阻塞IO方式  
`noatime`：读写数据不更新访问时间  

应用实例
---

1.将本地的/dev/hdb整盘备份到/dev/hdd

heng@me: dd if=/dev/hdb of=/dev/hdd

2.将/dev/hdb全盘数据备份到指定路径的image文件

heng@me: dd if=/dev/hdb of=/root/image

3.将备份文件恢复到指定盘

heng@me: dd if=/root/image of=/dev/hdb

4.备份/dev/hdb全盘数据，并利用gzip工具进行压缩，保存到指定路径

heng@me: dd if=/dev/hdb | gzip > /root/image.gz

5.将压缩的备份文件恢复到指定盘

heng@me: gzip -dc /root/image.gz | dd of=/dev/hdb

6.备份与恢复MBR

备份磁盘开始的512个字节大小的MBR信息到指定文件：

heng@me: dd if=/dev/hda of=/root/image count=1 bs=512

count=1指仅拷贝一个块；bs=512指块大小为512个字节。

恢复：

heng@me: dd if=/root/image of=/dev/had

将备份的MBR信息写到磁盘开始部分

7.备份软盘

heng@me: dd if=/dev/fd0 of=disk.img count=1 bs=1440k (即块大小为1.44M)

8.拷贝内存内容到硬盘

heng@me: dd if=/dev/mem of=/root/mem.bin bs=1024 (指定块大小为1k)

9.拷贝光盘内容到指定文件夹，并保存为cd.iso文件

heng@me: dd if=/dev/cdrom(hdc) of=/root/cd.iso

10.增加swap分区文件大小

第一步：创建一个大小为256M的文件：

heng@me: dd if=/dev/zero of=/swapfile bs=1024 count=262144

第二步：把这个文件变成swap文件：

heng@me: mkswap /swapfile

第三步：启用这个swap文件：

heng@me: swapon /swapfile

第四步：编辑/etc/fstab文件，使在每次开机时自动加载swap文件：

/swapfile swap swap default 0 0

11.销毁磁盘数据

heng@me: dd if=/dev/urandom of=/dev/hda1

注意：利用随机的数据填充硬盘，在某些必要的场合可以用来销毁数据。

12.测试硬盘的读写速度

heng@me: dd if=/dev/zero bs=1024 count=1000000 of=/root/1Gb.file

heng@me: dd if=/root/1Gb.file bs=64k | dd of=/dev/null

通过以上两个命令输出的命令执行时间，可以计算出硬盘的读、写速度。

13.确定硬盘的最佳块大小：

heng@me: dd if=/dev/zero bs=1024 count=1000000 of=/root/1Gb.file

heng@me: dd if=/dev/zero bs=2048 count=500000 of=/root/1Gb.file

heng@me: dd if=/dev/zero bs=4096 count=250000 of=/root/1Gb.file

heng@me: dd if=/dev/zero bs=8192 count=125000 of=/root/1Gb.file

通过比较以上命令输出中所显示的命令执行时间，即可确定系统最佳的块大小。

14.修复硬盘：

heng@me: dd if=/dev/sda of=/dev/sda 或dd if=/dev/hda of=/dev/hda

当硬盘较长时间(一年以上)放置不使用后，磁盘上会产生magnetic flux point，当磁头读到这些区域时会遇到困难，并可能导致I/O错误。当这种情况影响到硬盘的第一个扇区时，可能导致硬盘报废。上边的命令有可能使这些数 据起死回生。并且这个过程是安全、高效的。

15.利用netcat远程备份

heng@me: dd if=/dev/hda bs=16065b | netcat < targethost-IP > 1234

在源主机上执行此命令备份/dev/hda

heng@me: netcat -l -p 1234 | dd of=/dev/hdc bs=16065b

在目的主机上执行此命令来接收数据并写入/dev/hdc

heng@me: netcat -l -p 1234 | bzip2 > partition.img

heng@me: netcat -l -p 1234 | gzip > partition.img

以上两条指令是目的主机指令的变化分别采用bzip2、gzip对数据进行压缩，并将备份文件保存在当前目录。

16.将一个很大的视频文件中的第i个字节的值改成0x41（也就是大写字母A的ASCII值）

echo A | dd of=bigfile seek=$i bs=1 count=1 conv=notrunc