---
layout: post
title: YOLOv2参数解析
category : 机器学习
tags : [YOLO, python, c, darknet]
stickie: true
---

前言
---

其实这一部分内容我在源代码分析中都有讲过，但是由于参数太多，所以特意做一次总结。如果你对于源代码很感兴趣，但对于这么多的代码，无从下手的话，你可以看我写的一系列文章[YOLOv2源码分析](http://blog.csdn.net/column/details/18380.html)

参数总结
---

其实yolo v2的参数主要集中在两个结构体中一个是`network`，一个是`layer`

```c
typedef struct network{
    int n;				//网络总层数
    int batch;			//一个batch包含的图片数目，看下面的subdivisions
    size_t *seen;		//已经读取的图片数量
    int *t;
    float epoch;		//训练的次数
    int subdivisions;	//注意前面的batch/subdivisions才是网络的batch大小，可能目的是防止gpu显存不够
    layer *layers;		//指向网络的层
    float *output;		//指向输出特征图的内存空间
    learning_rate_policy policy;//学习率的策略，是一个枚举类型

    float learning_rate;//学习率
    float momentum;		//动量，一般0.9
    float decay;		//权重衰减正则项，防止过拟合
    float gamma;		//用于计算学习率
    float scale;		//用于计算学习率
    float power;		//用于计算学习率
    int time_steps;		//rnn中的移动步数
    int step;			//用于计算学习率
    int max_batches;	//最大的训练batch数目
    float *scales;		//用于计算学习率
    int   *steps;		//用于计算学习率
    int num_steps;		//steps中的数据个数
    int burn_in;

    int adam;			//adam算法
    float B1;			//一阶矩估计的指数衰减率
    float B2;			//二阶矩估计的指数衰减率
    float eps;			//为了防止在实现中除以零

    int inputs;			//h*w*c输入图像大小
    int outputs;		//输出图像大小
    int truths;			//每一张图片含有的真实值参数个数
    int notruth;
    int h, w, c;			//输入图像的高，宽，通道数
    int max_crop;			//控制图片缩放的最大值
    int min_crop;			//控制图片缩放的最小值
    float max_ratio;		//控制图片缩放的最大比例
    float min_ratio;		//控制图片缩放的最小比例
    int center;
    float angle;			//设置旋转角度，扩充数据
    float aspect;			//设置方位，扩充数据
    float exposure;			//设置曝光量，扩充数据
    float saturation;		//设置饱和度，扩充数据
    float hue;				//设置色调，扩充数据
    int random;				//random为1时随机使用不同尺寸的图片进行训练

    int gpu_index;			//设置第几个gpu
    tree *hierarchy;

    float *input;			//输入图像存储空间
    float *truth;			//存储了网络输入的所有图片的真实矩形框信息
    float *delta;			//误差存储空间
    float *workspace;		//
    int train;
    int index;
    float *cost;

#ifdef GPU
    float *input_gpu;
    float *truth_gpu;
    float *delta_gpu;
    float *output_gpu;
#endif

} network;
```



```c
struct layer{
    LAYER_TYPE type;		//layer类型
    ACTIVATION activation;	//激活函数类型
    COST_TYPE cost_type;	//损失函数类型
    void (*forward)   (struct layer, struct network);	//不同的forward函数
    void (*backward)  (struct layer, struct network);	//不同的backward函数
    void (*update)    (struct layer, update_args);		//不同的update函数
    void (*forward_gpu)   (struct layer, struct network);
    void (*backward_gpu)  (struct layer, struct network);
    void (*update_gpu)    (struct layer, update_args);
    int batch_normalize;	//BN操作
    int shortcut;			//shortcut连接操作
    int batch;				//batch大小
    int forced;
    int flipped;
    int inputs;				//输入的元素个数
    int outputs;			//输出的元素个数
    int nweights;			//权重数目
    int nbiases;			//偏向数目
    int extra;
    int truths;				//30*(5)，5表示class以及coordinate（xywh），30表示一幅图片最多处理多少个目标框
    int h,w,c;				//输入图像的高度，宽度，通道数
    int out_h, out_w, out_c;//输出图像的高度，宽度，通道数
    int n;					//卷积层中表示卷积核的个数，region中表示anchors个数
    int max_boxes;			//30，表示一幅图片最多有多少目标在相同位置
    int groups;				//卷积核组数
    int size;				//kernel_size（包括卷积、池化）
    int side;
    int stride;				//步长（包括卷积、池化）
    int reverse;
    int flatten;
    int spatial;
    int pad;				//图像周围是否补0
    int sqrt;				//预测w,h是否开方
    int flip;				//翻转
    int index;
    int binary;				//权重二值化
    int xnor;				//权重和输入二值化
    int steps;
    int hidden;				//隐藏层的数量
    int truth;
    float smooth;
    float dot;
    float angle;			//旋转角度
    float jitter;			//抖动
    float saturation;		//饱和度
    float exposure;			//曝光量
    float shift;			//移动
    float ratio;			//缩放比率
    float learning_rate_scale;//学习率系数
    int softmax;			//是否使用softmax
    int classes;			//类别个数
    int coords;				//4（坐标参数个数）
    int background;
    int rescore;			//非0时调整l.delta
    int objectness;
    int does_cost;
    int joint;
    int noadjust;			//是否调整
    int reorg;
    int log;				//是否计算log
    int tanh;				//gru中是否使用tanh激活函数

    float alpha;
    float beta;
    float kappa;

    float coord_scale;		//cost function的权重
    float object_scale;		//cost function的权重
    float noobject_scale;	//cost function的权重
    float mask_scale;		//cost function的权重
    float class_scale;		//cost function的权重
    int bias_match;			//为1时，计算best iou时，预测宽高强制与anchors一致 
    int random;				//为1时随机改变图片大小
    float thresh;			//决定cost function是否有IOU
    int classfix;
    int absolute;

    int onlyforward;
    int stopbackward;
    int dontload;
    int dontloadscales;

    float temperature;
    float probability;
    float scale;

    char  * cweights;
    int   * indexes;
    int   * input_layers;
    int   * input_sizes;
    int   * map;
    float * rand;
    float * cost;			//损失
    float * state;			//rnn中当前层的状态
    float * prev_state;		//rnn中前一层的状态
    float * forgot_state;	//gru参数
    float * forgot_delta;
    float * state_delta;
    float * combine_cpu;
    float * combine_delta_cpu;

    float * concat;
    float * concat_delta;

    float * binary_weights;	//二值化的权重

    float * biases;			//偏置，BN中的系数beta；region层中的anchors
    float * bias_updates;	//更新后的偏置

    float * scales;			//BN中的系数gamma
    float * scale_updates;

    float * weights;		//权重
    float * weight_updates;	//更新后的权重

    float * delta;			//一个batch的梯度信息（region）
    float * output;			//一个batch的输出存储空间（region）
    float * squared;
    float * norms;

    float * spatial_mean;
    float * mean;			//标准差
    float * variance;		//方差

    float * mean_delta;
    float * variance_delta;

    float * rolling_mean;
    float * rolling_variance;

    float * x;
    float * x_norm;

    float * m;
    float * v;
    
    float * bias_m;
    float * bias_v;
    float * scale_m;
    float * scale_v;


    float *z_cpu;			//gru
    float *r_cpu;			//gru
    float *h_cpu;			//gru
    float * prev_state_cpu;

    float *temp_cpu;
    float *temp2_cpu;
    float *temp3_cpu;

    float *dh_cpu;
    float *hh_cpu;
    float *prev_cell_cpu;
    float *cell_cpu;
    float *f_cpu;
    float *i_cpu;
    float *g_cpu;
    float *o_cpu;
    float *c_cpu;
    float *dc_cpu; 

    float * binary_input;

    struct layer *input_layer;
    struct layer *self_layer;
    struct layer *output_layer;

    struct layer *reset_layer;
    struct layer *update_layer;
    struct layer *state_layer;

    struct layer *input_gate_layer;
    struct layer *state_gate_layer;
    struct layer *input_save_layer;
    struct layer *state_save_layer;
    struct layer *input_state_layer;
    struct layer *state_state_layer;

    struct layer *input_z_layer;
    struct layer *state_z_layer;

    struct layer *input_r_layer;
    struct layer *state_r_layer;

    struct layer *input_h_layer;
    struct layer *state_h_layer;
	
    struct layer *wz;				//gru参数
    struct layer *uz;				//gru参数
    struct layer *wr;				//gru参数
    struct layer *ur;				//gru参数
    struct layer *wh;				//gru参数
    struct layer *uh;				//gru参数
    struct layer *uo;
    struct layer *wo;
    struct layer *uf;
    struct layer *wf;
    struct layer *ui;
    struct layer *wi;
    struct layer *ug;
    struct layer *wg;

    tree *softmax_tree;

    size_t workspace_size;
  ...
}
```

