---
layout: post
title: QT5.9.1和opencv3.3配置(win10)
category : QT
tags : [opencv, cpp, qt]
stickie: true
---

环境配置
---

首先你要安装好[CMake](https://cmake.org/download/)、[QT](https://www1.qt.io/developers/)、[opencv](https://opencv.org/)，并且配置好相应的环境变量

接着我们要对opencv进行编译，我这里使用QT自带的MinGW。这里要注意的是，如果之前有安装过MinGW，并且配置过相应的环境变量的话，记得要把环境变量里面的值删除，否则会与QT自带的MinGW冲突。

这个是我安装opencv的位置

<a href="http://wx4.sinaimg.cn/mw690/af2d2659ly1fkme6ifhi6j20t60icq4s.jpg" data-lightbox="roadtrip">
<img src="http://wx4.sinaimg.cn/mw690/af2d2659ly1fkme6ifhi6j20t60icq4s.jpg" class="img-fluid">
</a>

然后在where is the source code 和 where to bulid the binaries中分别添加opencv的路径和要编译的位置，这里我的编译文件夹设置为QT_bulid

<a href="http://wx4.sinaimg.cn/mw690/af2d2659ly1fkme6it6yrj20k30ig74f.jpg" data-lightbox="roadtrip">
<img src="http://wx4.sinaimg.cn/mw690/af2d2659ly1fkme6it6yrj20k30ig74f.jpg" class="img-fluid">
</a>

下面这一步很关键，点击configure，然后选择默认选项Use default native compliers，如果这里出现了错误，请仔细检查环境变量中是否有其他的MinGW。

<a href="http://wx4.sinaimg.cn/mw690/af2d2659ly1fkmkdgyxngj20dy0a1748.jpg" data-lightbox="roadtrip">
<img src="http://wx4.sinaimg.cn/mw690/af2d2659ly1fkmkdgyxngj20dy0a1748.jpg" class="img-fluid">
</a>

然后将WITH_QT和WITH_OPENGL选上，将OPENCV_EXTRA_MODULES_PATH设置，我这里设为`F:\opencv\opencv3\opencv-3.3.0\modules`再，根据你的opencv解压路径变化，再次Configure。

<a href="http://wx1.sinaimg.cn/mw690/af2d2659ly1fkmkdeofyoj20k30k5t9h.jpg" data-lightbox="roadtrip">
<img src="http://wx1.sinaimg.cn/mw690/af2d2659ly1fkmkdeofyoj20k30k5t9h.jpg" class="img-fluid">
</a>

<a href="http://wx4.sinaimg.cn/mw690/af2d2659ly1fkmkdggmzuj21f60u0gnt.jpg" data-lightbox="roadtrip">
<img src="http://wx4.sinaimg.cn/mw690/af2d2659ly1fkmkdggmzuj21f60u0gnt.jpg" class="img-fluid">
</a>

接着会报一系列错误

<a href="http://wx4.sinaimg.cn/mw690/af2d2659ly1fkmkdf232ij20k30k5mye.jpg" data-lightbox="roadtrip">
<img src="http://wx4.sinaimg.cn/mw690/af2d2659ly1fkmkdf232ij20k30k5mye.jpg" class="img-fluid">
</a>

将上图中的红色部分的Value变为

```
F:\qt5.9\5.9.1\mingw53_32\bin\qmake.exe
F:\qt5.9\5.9.1\mingw53_32\lib\cmake\Qt5Concurrent
F:\qt5.9\5.9.1\mingw53_32\lib\cmake\Qt5Core
F:\qt5.9\5.9.1\mingw53_32\lib\cmake\Qt5Gui
F:\qt5.9\5.9.1\mingw53_32\lib\cmake\Qt5Test
F:\qt5.9\5.9.1\mingw53_32\lib\cmake\Qt5Widgets
```

然后又再次报错，道路总是这么的曲折！^_^这次的问题出在了`Qt5OpenGL_DIR`（当然可能会有别的红色部分，我们只关心gl相关的错误）

将他设置为`F:\qt5.9\5.9.1\mingw53_32\lib\cmake\Qt5OpenGL`，最后所有都设置好后，如下图（当然你可能和我的图不一样，不用担心，只要设置好就ok）

注意到这里，我们要记得将之前设置的OPENCV_EXTRA_MODULES_PATH置为空，也就是开始时什么都没有的状态，否则会出问题。另外在`F:\opencv\opencv3\opencv-3.3.0\cmake`文件夹下找到`OpenCVCompilerOptions.cmake`文件，将`add_extra_compiler_option(-Werror=non-virtual-dtor)`前面加一个#，再次Configure。

<a href="http://wx1.sinaimg.cn/mw690/af2d2659ly1fkmkdfyhexj21f60u0acc.jpg" data-lightbox="roadtrip">
<img src="http://wx1.sinaimg.cn/mw690/af2d2659ly1fkmkdfyhexj21f60u0acc.jpg" class="img-fluid">
</a>

这次没出现问题了，谢天谢地！！！点击Generate

在我们之前设置的文件夹QT_bulid中，建立这样一个批处理文件`run.bat`，内容如下

```
mingw32-make
mingw32-make install
```

双击批处理即可。

在编译过程中会出现这样的一个问题，果然是命途多舛，哎！！！

```
windres.exe: unknown option -- W
```

问题的原因出在cmake的版本，如果使用的是3.8就没有问题，别的版本就不清楚了，我使用的是3.10版本，爆了这样的错误。

不幸的是，你要按照之前的步骤重新来过，再来过之前，先把原来的相关文件夹清空，避免再次出现一些不相关的问题。

<a href="http://wx1.sinaimg.cn/mw690/af2d2659ly1fkmlesur5jj21f60u0jtn.jpg" data-lightbox="roadtrip">
<img src="http://wx1.sinaimg.cn/mw690/af2d2659ly1fkmlesur5jj21f60u0jtn.jpg" class="img-fluid">
</a>

又回到了那个熟悉的界面，我发誓我真的不想再见到它了！！！将`ENABLE_PRECOMPILED_HEADERS`的钩去掉。再次configure，ok没报错，接着generate。

通过之前写的批处理，此时你应该把它删除了，所以再次建立一个批处理，双击它。

不过居然又报错了，呵呵！！！

```
modules\videoio\CMakeFiles\opencv_videoio.dir\build.make:187: recipe for target 'modules/videoio/CMakeFiles/opencv_videoio.dir/src/cap_dshow.cpp.obj' failed
mingw32-make[2]: *** [modules/videoio/CMakeFiles/opencv_videoio.dir/src/cap_dshow.cpp.obj] Error 1
CMakeFiles\Makefile2:2912: recipe for target 'modules/videoio/CMakeFiles/opencv_videoio.dir/all' failed
mingw32-make[1]: *** [modules/videoio/CMakeFiles/opencv_videoio.dir/all] Error 2
Makefile:161: recipe for target 'all' failed
mingw32-make: *** [all] Error 2
```

在`F:\opencv\opencv3\opencv-3.3.0\modules\videoio\src`文件夹中的cap_dshow.cpp中添加

```
#define STRSAFE_NO_DEPRECATE
```

然后再按上面的步骤重新来一遍，我呵呵了！！！记得不要漏了步骤，否则你懂的！！！！

我的笔记本配置比较老是i7-4910的cpu，所以花费了很长的时间编译，不过让我感到欣慰的是，总算配置好了。^_^!!!

最后一步就是新建一个文件夹，例如`F:\opencv\opencv3\QT_opencv`，~~将opencv的安装文件夹`F:\opencv\opencv3\opencv-3.3.0`下的include文件夹copy过来，再将之前建立的目录`F:\opencv\opencv3\QT_bulid`下的bin和lib文件夹copy过来。最后将`F:\opencv\opencv3\QT_bulid\bin`添加到环境变量。~~将之前install opencv的目录下的所有文件copy过来，注意这里的install opencv目录是指后来编译安装目录，不是之前的opencv目录，我这里是`F:\opencv\opencv3\QT_bulid\install`。

ok，所有工作完成。

最后为了节省大家的时间，我把编译后的opencv3.3传到了CSDN上，由于上传大小限制，所以分成了两个文件，我真的不是为了骗积分（好吧，其实有一点╮(╯-╰)╭）！[opencv3.3编译文件](http://download.csdn.net/download/qq_17550379/10028618)[opencv3.3编译文件2](http://download.csdn.net/download/qq_17550379/10028622)

下一节正式开始我们的编程之旅^_^！！