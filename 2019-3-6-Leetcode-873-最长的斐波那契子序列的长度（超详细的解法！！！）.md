---
layout: post
title: Leetcode 873：最长的斐波那契子序列的长度（超详细的解法！！！）
category : 算法
tags : [python, c, c++]
stickie: true
date: 2019-3-6 00:00:00
---

如果序列 `X_1, X_2, ..., X_n` 满足下列条件，就说它是 *斐波那契式* 的：

- `n >= 3`
- 对于所有 `i + 2 <= n`，都有 `X_i + X_{i+1} = X_{i+2}`

给定一个**严格递增**的正整数数组形成序列，找到 `A` 中最长的斐波那契式的子序列的长度。如果一个不存在，返回  0 。

*（回想一下，子序列是从原序列 A 中派生出来的，它从 A 中删掉任意数量的元素（也可以不删），而不改变其余元素的顺序。例如， [3, 5, 8] 是 [3, 4, 5, 6, 7, 8] 的一个子序列）*

**示例 1：**

```
输入: [1,2,3,4,5,6,7,8]
输出: 5
解释:
最长的斐波那契式子序列为：[1,2,3,5,8] 。
```

**示例 2：**

```
输入: [1,3,7,11,12,14,18]
输出: 3
解释:
最长的斐波那契式子序列有：
[1,11,12]，[3,11,14] 以及 [7,11,18] 。
```

**提示：**

- `3 <= A.length <= 1000`
- `1 <= A[0] < A[1] < ... < A[A.length - 1] <= 10^9`
- *（对于以 Java，C，C++，以及 C# 的提交，时间限制被减少了 50%）*

**解题思路**

因为这个问题的时间复杂度要求不高，所以我们可以想到通过暴力法解决这个问题。我们可以通过两个循环，找到`斐波那契式子序列`的前两个数，然后找后面的数是不是出现在`A`中即可（所以我们可以使用`set`）。

```python
class Solution:
    def lenLongestFibSubseq(self, A: List[int]) -> int:
        S = set(A)
        n, res = len(A), 0
        for i in range(n):
            for j in range(i+1, n):
                x, y = A[j], A[i] + A[j]
                l = 2
                # <- add prune
                while y in S:
                    x, y = y, x+y
                    l += 1
                res = max(res, l)
        return res if res >= 3 else 0
```

这种解法当然不是最好的，要怎么优化呢？我们这里有一个剪枝操作，我们注意到这是一个递增的数组，那么实际上我们可以不用立即判断`y`是不是在`S`中

```python
if (res - 2)*x >= A[-1]: break
```

我们也可以通过动态规划的方法，首先我们定义函数`f(i, j)`表示以`i, j`结尾的斐波那契数列的长度，那么

- $f(i, j)=(f(j-i,i)+1)\ or\ 2$

```python
class Solution:
    def lenLongestFibSubseq(self, A: List[int]) -> int:
        dp = collections.defaultdict(int)
        S = set(A)
        for j in range(len(A)):
            for i in range(j):
                if A[j] - A[i] < A[i] and A[j] - A[i] in S:
                    dp[A[i], A[j]] = dp.get((A[j] - A[i], A[i]), 2) + 1
        return max(dp.values() or [0])
```

reference:

https://leetcode.com/problems/length-of-longest-fibonacci-subsequence/discuss/152343/C%2B%2BJavaPython-Check-Pair

**我将该问题的其他语言版本添加到了我的[GitHub Leetcode](https://github.com/luliyucoordinate/Leetcode)**

**如有问题，希望大家指出！！！**