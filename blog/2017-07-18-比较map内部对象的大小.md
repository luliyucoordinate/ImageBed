---
layout: post
title: 比较map内部对象的大小
category : cpp
tags : [cpp, map]
stickie: true
---

问题描述：对一个大小给定的map\<size_t, Checkout\>中的Checkout对象作比较，对其最小值做插入操作

Checkout对象如下：

```c++
class Checkout
{
private:
  std::queue<Customer> customers;                // The queue waiting to checkout
public:
  void add(const Customer& customer) { customers.push(customer); }
  size_t qlength() const { return customers.size(); }

  // Increment the time by one minute
  void time_increment()
  {
    if (!customers.empty())
    { // There are customers waiting...
      if (customers.front().time_decrement().done())  // If the customer is done...
        customers.pop();                              // ...remove from the queue
    }
  };

  bool operator<(const Checkout& other) const { return qlength() < other.qlength(); }
  bool operator>(const Checkout& other) const { return qlength() > other.qlength(); }
  Checkout& operator=(const Checkout& other) { customers = other.customers; return *this; }
};
```
解决办法：

```c++
template<class ForwardIt>
ForwardIt min_checkout(ForwardIt first, ForwardIt last)
{
	if (first == last) return last;

	Checkout smallest = first->second;//注意这里的细节
	ForwardIt pr = first;
	++first;
	for (; first != last; ++first) {
		if (first->second < smallest) {
			smallest = first->second;
			pr = first;
		}
	}
	return pr;
}

...

min_checkout(std::begin(checkouts), std::end(checkouts))->second.add(Customer(service_t));
```
这里还要注意一个问题，就是对map要做一次初始化，给其分配空间

```c++
map<std::string, Checkout> checkouts;//关于如何初始化一个大小给定的map。我也没有什么好的做法，只能想到这样。
Checkout init;

for (size_t i{}; i < n_checkouts; ++i)
{
    auto pr = std::make_pair(std::to_string(i), init);
    checkouts.insert(pr);
}
```