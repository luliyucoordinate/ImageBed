---
layout: post
title: 	SQL注入中的一些小技巧
category : 信息安全
tags : [sql注入, mysql]
stickie: true
---

0x01 mysql的注入方式
---

1.   \# 到该行结束     \# 这个注释直到该行结束 
2.   -- 到该行结束      -- 这个注释直到该行结束

注意： -- (双长划) 注释风格要求在两个长划后至少有一个空格！自MySQL3.23.3 以来，除了刚才介绍的注释风格外，还可以用两个短划线和一个空格（“-- ”）来开始注释；从这两个短划线到行的结束的所有内容都作为注释处理。有的数据库以双短划线作为注释的起始。MySQL也允许这样，但需要加一个空格以免产生混淆。例如，带有如像5--7 这样的表达式的语句有可能被认为包含一个注释，但不可能写5-- 7这样的表达式，因此，这是一个很有用的探索。然而，这仅仅是一个探索，最好不用这种风格的注释。

3.  /* 行中间或多个行 */

单引号和双引号：被用来标志一个被引用字符串的开始，即使是在一个注释中。如果注释中的引号没有另一个引号与之配对，那和语法分析程序就不会认为注释结束。如果你以交互式运行 mysql，你会产生困惑，因为提示符从 mysql> 变为 '> 或 ">。

分号：被用于指出当前 SQL 语句的结束并且跟随它的任何东西表示下一行的开始。

0x02 limit下的字段数判断
---

众所周知where条件下的字段数可以用order by判断，而limit后可以利用 limit 0,1 into @,@ （@的数目为字段数）@为mysql临时变量

例如：

```sql
select * from hehe limit 0,1 into @,@;
```

0x03 or条件下的回显
---

例子：

```sql
select * from hehe where id='1' or '1'='1'; /*显示所有记录*/
select * from hehe where id='1' or '1'='2'; /*只显示id=1记录*/
select * from hehe where id='2' or '1'='2'; /*只显示id=2记录*/
```

0x04 concat与concat_ws与group_concat
---

MySQL的concat函数在连接字符串的时候，只要其中一个是NULL,那么将返回NULL

```sql
SQL> SELECT CONCAT('FIRST ', 'SECOND');
+----------------------------+
| CONCAT('FIRST ', 'SECOND') |
+----------------------------+
| FIRST SECOND               |
+----------------------------+
1 row in set (0.00 sec)

SQL> SELECT CONCAT('FIRST ', null);
+------------------------+
| CONCAT('FIRST ', null) |
+------------------------+
| null                   |
+------------------------+
1 row in set (0.00 sec)
```
和concat不同的是, concat_ws函数在执行的时候,不会因为NULL值而返回NULL

0x05 逻辑操作符被过滤
---

我们知道在 MySQL 中使用 SQL SELECT 命令来读取数据， 同时我们可以在 SELECT 语句中使用 WHERE 子句来获取指定的记录。  
WHERE 子句中可以使用等号 = 来设定获取数据的条件，如 "runoob_author = 'RUNOOB.COM'"。
但是有时候我们需要获取 runoob_author 字段含有 "COM" 字符的所有记录，这时我们就需要在 WHERE 子句中使用 SQL LIKE 子句。  
SQL LIKE 子句中使用百分号 %字符来表示任意字符，类似于UNIX或正则表达式中的星号 \*。  
如果没有使用百分号 %, LIKE 子句与等号 = 的效果是一样的。  

例子：

```sql
mysql> SELECT * from runoob_tbl  WHERE runoob_author LIKE '%COM';
+-----------+---------------+---------------+-----------------+
| runoob_id | runoob_title  | runoob_author | submission_date |
+-----------+---------------+---------------+-----------------+
| 3         | 学习 Java   | RUNOOB.COM    | 2015-05-01      |
| 4         | 学习 Python | RUNOOB.COM    | 2016-03-06      |
+-----------+---------------+---------------+-----------------+
2 rows in set (0.01 sec)
```

0x06 ’被过滤
---

1.  hex编码

   ```sql
   SELECT password FROM Users WHERE username = 0x61646D696E
   ```

2.  char编码

   ```sql
   SELECT FROM Users WHERE username = CHAR(97, 100, 109, 105, 110)
   ```

3.  html实体字符编码

   ```sql
   SELECT FROM Users WHERE username = 'admin'%2527
   ```

4.  二次编码%2527

   这里主要是因为绕过magic_quotes_gpc过滤，因为%25解码为%,结合后面的27也就是%27也就是’，所以成功绕过过滤。  

5.  宽字节

   大家都知道%df’ 被PHP转义（开启GPC、用addslashes函数，或者icov等），单引号被加上反斜杠\，变成了 %df\’，其中\的十六进制是 %5C ，那么现在%df\’ =%df%5c%27，如果程序的默认字符集是GBK等宽字节字符集，则MySQL用GBK的编码时，会认为 %df%5c 是一个宽字符，也就是縗’，也就是说：%df\’ = %df%5c%27=縗’，有了单引号就好注入了。


0x07 表名等关键字被过滤
---

以information_schema.tables为例

空格 information_schema . tables

着重号 information\</em\>schema.tables

特殊符 /!informationschema.tables/

别名 information_schema.(partitions),(statistics),(keycolumnusage),(table_constraints)

0x08 表单认证绕过
---

```sql
"SELECT username FROM users WHERE username='$username' AND password='$password'"
```
这样的直接username=admin'#即可，或者username='='&password='='这样就能构造出

```sql
"SELECT username FROM users WHERE username=''='' AND password=''=''"
#即
$sql = “select user from flag where 1 and 1”;
```
