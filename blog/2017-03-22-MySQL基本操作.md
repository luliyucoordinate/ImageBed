---
layout: post
title: MySQL基本操作
category : 数据库
tags : [sql, MySQL]
stickie: true
---


Sql语句
===

多表查询，不同表之间一定要有一个字段关联  
表里面的列称为字段field，行成为记录record  
对于SELECt后面的WHERE字句中用到的字段，原则是必须建相应的索引。索引不要乱箭，精准，不能多。  
索引可以提高SELECT语句的速度，但代价是降低了INSERT，UPDATE和DELETE语句的速度。



修改数据
---
```shell
UPDATE TABLENAME SET CAL1=VAL1, CAL2=VAL2… WHERE CONDITIONAL
```
Set语句指定要修改的字段和所附的值，where字句指定要修改的行，如果没有where语句，代表修改所有行  
例子：

```sql
mysql> update table1 set sex = '女' where name = '张三';
```


删除语句
---
```shell
DELETE FROM TABLENAME WHERE CONDITIONAL
```
where语句指定要删除的行，如果没有where代表删除所有行  
例子：

```sql
mysql> delete from table1 where name = '张三';
```
注意一点：/usr/include是gcc查找头文件的默认路径。



数据库编程
===

mysql编程首先要做的工作  
头文件#include <mysql/mysql.h>  
makefile文件，链接的时候添加-lmysqlclient选项（意思是要链接到libmysqlclient.so这个库文件）  
数据库client与server之间也是采用TCP协议



连接到mysql步骤
---

初始化client

```c
Mysql_init(MYSQL *pmysql);
```

建立连接

```c
MYSQL *mysql_real_connect(MYSQL *pmysql, const char *hostname,const char *usename,const char *passed, const char *dbname, 0,0,0);
```
成功返回mysql连接的指针，失败返回NULL  
通过mysql_error获取错误  
client向server发送SQL语句，server将执行SQL语句的结果返回给client  
写网络程序的原则，第一次写的时候，一定要拿本机做实验，  
"localhost" = "127.0.0.1"

执行sql语句  

```c
int mysql_query(MYSQL *pmysql,const char *sql);
```
参数pmysql是连接到MySql的指针  
参数sql是要执行的sql语句  
成功返回0，失败返回非零  
注意一点  

```c
if(mysql_query(connection, "SET NAMES utf8") != 0)
{
	printf("utf8 error %s" ,mysql_error(&mysql));
	return -1;
}
```
编写mysql程序，成功连接到server之后，以一个执行的语句是设置字符集SET NAMES utf8;  
linux下printf函数是以\n结尾的字符串才输出到屏幕的，如果没有\n直到输出缓冲区满了以后才打印到屏幕

断开连接  
mysql_close(MYSQL *)



控制台程序，输入退格键不回显的方法
---
命令

```shell
stty erase ^H
system(“stty erase ^H”);
```
可以实现在输入状态下，按退格键删除字符，不回显  
调用tcsetattr修改linux基本输出输入的控制字符定义  
//////////////////////////////去掉退格键回显的代码

```c
<termios.h>
struct termios term;//定义一个temions结构
if(tcgetattr(STDIN_FILENO, &term) == -1)//得到系统termion的设置
{
	printf("tcgetattr error is %s\n", strerror(errno));
	return;
}
term.c_cc[VERASE] = '\b';//'\b'为退格键的ASCII码
if (tcsetattr(STDIN_FILENO, TCSANOW, &term) == -1)//设置系统termion
{
	printf("tcsetattr error is %s\n", strerror(errno));
}
```


执行select语句得到查询结果
---
```c
MYSQL_RES *mysql_store_result(MYSQL *pmysql);
```
成功返回一个查询结果指针，查询无结果或者错误返回NULL  

```c
mysql_free_result(MYSQL_RES *res)
```
调用完mysql_store_result，一定要用mysql_free_result释放相关资源


查看查询结果
---
```c
MYSQL_ROW mysql_fetch_row(MYSQL_ROW *result);
```
例子：

```c
while(row = mysql_fetch_row(result) != NULL)
{
	printf(“name:%s,sex:%s,age:%s,class:%s\n”,row[0], row[1], row[2], row[3]);
} 
```
尽管在表中age是数字，但是mysql返回的只不过是以NULL结尾的字符串


查看查询结果中的字段信息
---
```c
MYSQL_FIELD *mysql_fetch_field(MYSQL_RES *result);
```
例子：

```c
while((sqlField = mysql_fetch_field(result) != NULL)
{
	printf(“%s\n”, sqlField->name);
}
```

mysql_fetch_row返回是记录（行）  
mysql_fetch_field返回是字段（列）


积累
===

关于/usr/bin/ld: cannot find –lmysqlclient错误  
去/usr/lib文件下去寻找，所以做个软链接即可。  

```
# cd /usr/lib
# ln -s /usr/lib64/mysql /usr/lib
```
设置环境变量export LIBRARY_PATH=/usr/lib/mysql后，gcc -o mysql mysql.c -lmysqlclient通过

ctrl+s锁屏  
ctrl+q解锁

1.  \n 软回车：  
在Windows 中表示换行且回到下一行的最开始位置。相当于Mac OS 里的 \r 的效果。  
在Linux、unix 中只表示换行，但不会回到下一行的开始位置。

2.  \r 软空格：  
在Linux、unix 中表示返回到当行的最开始位置。  
在Mac OS 中表示换行且返回到下一行的最开始位置，相当于Windows 里的 \n 的效果。
 
3.  \t 跳格（移至下一列）。  
它们在双引号或定界符表示的字符串中有效，在单引号表示的字符串中无效。  
\r\n 一般一起用，用来表示键盘上的回车键，也可只用 \n。  
\t表示键盘上的“TAB”键。  
就像你使用 enter和shift+enter的区别
 
4.  文件中的换行符号：  
linux,unix: \r\n  
windows : \n  
Mac OS：\r

