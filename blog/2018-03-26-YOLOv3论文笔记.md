---
layout: post
title: YOLOv3论文笔记
category : 机器学习
tags : [YOLO, python, c, darknet]
stickie: true
date: 2018-03-26 00:00:00
---

论文地址：[YOLOv3: An Incremental Improvement](https://pjreddie.com/media/files/papers/YOLOv3.pdf)

项目地址：[darknet](https://github.com/pjreddie/darknet)

# 0x00 Foreword

今天看到YOLOv3发布的信息，第一个反应就是，我×，我之前的模型还没有训练好，现在又出来一个(T_T)。

不过我对于YOLOv3的发布还是很激动的，因为我之前和大多数人一样，对于`single-stage`报以很小的期望了，但是今天的YOLOv3让我又重新对于`single-stage`有了新的看法。

# 0x01 Abstract

关于`Bounding Box`的预测。同样使用在`YOLO 9000`中的维度聚类，找到最好的`boxes`的高宽。与传统的`K-means`聚类方法不同，作者使用的不是欧氏距离，而是使用的下面这种

- $d(box, centroid) = 1 - IOU(box, centroid)$

这样做的目的是，使`error`和`box`的大小没有关系。

<center class="half">
<img src="http://wx2.sinaimg.cn/mw690/af2d2659ly1fpqdlggsclj20di0a7aak.jpg" >
</center>

至于坐标预测计算也都是和`YOLOv2`相同。

关于种类的预测，没有使用`softmax`，而是使用了`sigmoid`。这种做法，对于重叠标签的数据会有所帮助（例如一个女性的图像，会标注女和人两个标签）。

关于多尺度。作者参考了`FPN`的设计。作者在特征提取网络后增加了几个卷积层，最后预测一个包含三种信息的张量（`bounding box`，目标和目标种类）。对于不同尺度使用三个`anchor box`进行预测。对于刚才说的网络的倒数第二层做上采样。从网络的前面部分获取特征图，使其和上采样后的特征图融合。然后添加卷积层处理融合后的特征图。这种做法避免了`SSD`中的细粒度信息的损失。

作者尝试了，通过预测常规方法的`anchor box`进行预测目标的位置，但是这种做法降低了模型的稳定。尝试通过线性激活函数代替`logistic`激活函数，结果也不是很好。尝试使用`Focal loss`，但是同样失败。

# 0x02 网络结构

作者此次将网络的深度增加到了53层，称为`Darknet-53`。

<center class="half">
<img src="http://wx2.sinaimg.cn/mw690/af2d2659ly1fpqcmrfeqij207q0acmxv.jpg" >
</center>

这个网络比之前的`Draknet-19`强大了许多，但是任然逊色于`ResNet-101`和`ResNet-152`。

<center class="half">
<img src="http://wx4.sinaimg.cn/mw690/af2d2659ly1fpqcmouibsj209f029aa6.jpg" >
</center>

`YOLOv3`虽然在精度上要比`FPN FRCN`低一些，但是速度上却快上很多，同时它无论是速度上还是精度上都超越了`RetinaNet`系列。

<center class="half">
<img src="http://wx1.sinaimg.cn/mw690/af2d2659ly1fpqcmtuwkvj2078079mxt.jpg" >
</center>

总的来说，`YOLOv3`并不像之前的`YOLO`系列那样给我一种惊艳的感觉，这次带给我们更多的是一些激励，速度快的网络它的精度也可以很不错。

# 0x03 cfg文件分析

#### 卷积层

```
[convolutional]
batch_normalize=1
filters=32
size=3
stride=1
pad=1
activation=leaky
```

这个不必多说什么，如果各位看过我之前写的[YOLOv2源码分析](https://blog.csdn.net/column/details/18380.html)应该不会有太大问题。

#### 跳转层

```
[shortcut]
from=-3
activation=linear
```

这个是`YOLOv3`中新添加的。它的第一个参数`from=-3`表示`shortcut`层的结果有它的前面一层和前面第三层的输出相加得到，这种设计就是参考了`resnet`。

#### `route`层

```
[route]
layers = -4
```

这同样是之前`YOLOv2`中的设计，它现在保留了下来。如果`layers`后面的参数只有一个的话，那么表示表示该层输出为之前第四层的特征图。（负号表示该层之前多少层，正号就表示对应的层数）

而如果`layers`后面的参数有两个的话，表示两个参数对应的层数（按深度叠加）后的输出。

#### 上采样层

```
[upsample]
stride=2
```

双线性上采样前面一层特征图。

后续我会对网络进行一些测试^_^！！！

如有问题，希望大家指出，谢谢各位！！！