---
layout: post
title: 	mismatch函数中的范围问题
category : cpp
tags : [cpp, mismatch, algorithm]
stickie: true
---

关于mismatch主要要聊的是下面这样的几个问题：

对于mismatch(iter1, end_iter1, iter2)

- 返回pair\<end_iter1, (iter2 + (end_iter1 - iter1))\>，pair的成员second等于iter2加上第一序列的长度。如果第二序列比第一序列短，结果是未定义的。

对于mismatch(iter1, end_iter1, iter2, end_iter2)

- 当第一个序列比第二个序列长时，返回pair\<end_iter1, (iter2 + (end_iter1 - iter1))\>，所以成员second为iter2加上第一个序列的长度
- 当第一个序列比第二个序列短时，返回pair\<(end_iter1 + (end_iter2 - iter2)), iter2 \>，所以成员first为iter1加上第一个序列的长度
- 当第一个序列和第二个序列一样长时，返回pair\<end_iter1, end_iter2\>

```c++
#include <iostream>                                      // For standard streams
#include <vector>                                        // For vector container
#include <algorithm>                                     // For equal() algorithm
#include <string>                                        // For string class
#include <iterator>                                      // For stream iterators

using std::string;
using word_iter = std::vector<string>::iterator;

int main()
{
	std::vector<string> words1{ "one", "two", "three", "four", "five", "six", "seven", "eight", "nine" };
	std::vector<string> words2{ "two", "three", "four", "five", "six", "seven", "eight", "nine", "ten" };
	auto iter1 = std::begin(words1);
	auto end_iter1 = std::end(words1);
	auto iter2 = std::begin(words2);
	auto end_iter2 = std::end(words2);

	// Lambda expression to output mismatch() result
	auto print_match = [](const std::pair<word_iter, word_iter>& pr, const word_iter& end_iter)
	{
		if (pr.first != end_iter)
			std::cout << "\nFirst pair of words that differ are "
			<< *pr.first << " and " << *pr.second << std::endl;
		else
			std::cout << "\nRanges are identical." << std::endl;
	};

	std::cout << "Container - words1:  ";
	std::copy(iter1, end_iter1, std::ostream_iterator<string>{std::cout, " "});
	std::cout << "\nContainer - words2:  ";
	std::copy(iter2, end_iter2, std::ostream_iterator<string>{std::cout, " "});
	std::cout << std::endl;

	std::cout << "\nCompare from words1[1] to end with words2:";
	print_match(std::mismatch(iter1 + 1, end_iter1, iter2), end_iter1);

	std::cout << "\nCompare from words2[0] to second-to-last with words1:";
	print_match(std::mismatch(iter2, end_iter2 - 1, iter1), end_iter2 - 1);

	std::cout << "\nCompare from words1[1] to words1[5] with words2:";
	print_match(std::mismatch(iter1 + 1, iter1 + 6, iter2), iter1 + 6);

	std::cout << "\nCompare first 6 from words1 with first 6 in words2:";
	print_match(std::mismatch(iter1, iter1 + 6, iter2, iter2 + 6), iter1 + 6);

	std::cout << "\nCompare all words1 with words2:";
	print_match(std::mismatch(iter1, end_iter1, iter2), end_iter1);

	std::cout << "\nCompare all of words2 with all of words1:";
	print_match(std::mismatch(iter2, end_iter2, iter1, end_iter1), end_iter2);

	std::cout << "\nCompare from words1[1] to end with words2[0] to second-to-last:";
	print_match(std::mismatch(iter1 + 1, end_iter1, iter2, end_iter2 - 1), end_iter1);

	auto& iptr = std::mismatch(iter1 + 1, end_iter1, iter2, end_iter2);

	system("pause");
}
```

输出结果为

```c++
Container - words1:  one two three four five six seven eight nine
Container - words2:  two three four five six seven eight nine ten

Compare from words1[1] to end with words2:
Ranges are identical.

Compare from words2[0] to second-to-last with words1:
First pair of words that differ are two and one

Compare from words1[1] to words1[5] with words2:
Ranges are identical.

Compare first 6 from words1 with first 6 in words2:
First pair of words that differ are one and two

Compare all words1 with words2:
First pair of words that differ are one and two

Compare all of words2 with all of words1:
First pair of words that differ are two and one

Compare from words1[1] to end with words2[0] to second-to-last:
Ranges are identical.
```
查看iper，结果如下，first指向的是一个未知的字符串

<a href="http://wx2.sinaimg.cn/mw690/af2d2659gy1fih7xoittuj20m102cweh.jpg" data-lightbox="roadtrip">
<img src="http://wx2.sinaimg.cn/mw690/af2d2659gy1fih7xoittuj20m102cweh.jpg" class="img-fluid">
</a>