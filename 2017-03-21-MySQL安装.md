---
layout: post
title: MySQL安装
category : 数据库
tags : [sql, MySQL]
stickie: true
---


MySql数据库
===


关于数据库的安装
---

首先centos7 已经不支持mysql，可能redhat也是如此，因为收费了你懂得，所以内部集成了mariadb，而安装mysql的话会和mariadb的文件冲突，所以需要先卸载掉mariadb。
```shell
[root@mysql opt]# rpm -qa | grep -i mysql
[root@mysql opt]# yum -y remove mysql-*
[root@mysql opt]# rpm -qa|grep mariadb
mariadb-libs-5.5.44-2.el7.x86_64
[root@mysql opt]# rpm -e mariadb-libs-5.5.44-2.el7.x86_64 --nodeps
[root@mysql opt]# rpm -ivh mysql-commercial-common-5.7.11-1.1.el6.x86_64.rpm
[root@mysql opt]# rpm -ivh mysql-commercial-libs-5.7.11-1.1.el6.x86_64.rpm
[root@mysql opt]# rpm -ivh mysql-commercial-libs-compat-5.7.11-1.1.el6.x86_64.rpm
[root@mysql opt]# rpm -ivh mysql-commercial-embedded-5.7.11-1.1.el6.x86_64.rpm
[root@mysql opt]# rpm -ivh mysql-commercial-devel-5.7.11-1.1.el6.x86_64.rpm
[root@mysql opt]# rpm -ivh mysql-commercial-embedded-devel-5.7.11-1.1.el6.x86_64.rpm
[root@mysql opt]# rpm -ivh mysql-commercial-client-5.7.11-1.1.el6.x86_64.rpm
[root@mysql opt]# rpm -ivh mysql-commercial-server-5.7.11-1.1.el6.x86_64.rpm

[root@mysql opt]# yum -y install perl-DBI
perl-DBI
perl-Compress-Raw-Bzip2
perl-Compress-Raw-Zlib
perl-Data-Dumper
perl-IO-Compress
perl-Net-Daemon
perl-PlRPC
[root@mysql opt]# rpm -ivh mysql-commercial-test-5.7.11-1.1.el6.x86_64.rpm
```
这样我们就把MySQL5.7.11企业版安装好了，当然最重点的地方也就来了，那就是初始化。

密码在/var/log/mysqld.log这个文件里，你可以用grep 'temporary password' /var/log/mysqld.log来查询，也可以自己在文件里找。  
For example, the cleartext password in the following statement is checked. Under the default password policy, which requires passwords to be at least 8 characters long, the password is weak and the statement produces an error: 

```
mysql> ALTER USER USER() IDENTIFIED BY 'abc';  
```
ERROR 1819 (HY000): Your password does not satisfy the current  
policy requirements  
通过 set password=password('new_password'); 命令重新设置密码；  
以上的方法，在MySQL 5.7早期版本时，还是很好用的，但在MySQL 5.7.6以后的版本，最后一点重置密码总是无法生效，会出来下面的错误。  
ERROR 1819 (HY000): Your password does not satisfy the current policy requirements  
同时，无法进行其它的操作。  
这是因为，自MySQL 5.7开始，密码存在有效期的概念， 同时因为安全等级的问题，需要使用使用其它的方式进行设置。另一个需要注意的点是， 自5.7.6开始废弃了password()函数，同时无法设置old_password=1， 这真的是一件比较曲折的探索过程。  
那么，先把MySQL 5.7.9版本以上的密码设置方法整理一下。  
大部分和上面整理的内容相同，关键在第4步后，把authentication_string 里写入的值记一下（这是因为password()函数已废弃）  
通过使用以下命令，代替第7步的， set password=password('new_password') 方法。

```sql
mysql> ALTER USER 'jeffrey'@'localhost'
    -> IDENTIFIED WITH mysql_native_password
    -> AS 'authentication_string字段内容';
Query OK, 0 rows affected (0.01 sec)
```


创建新的数据库
---
```
mysql> CREATE DATABASE [IF NOT EXISTS] db_name 
-> CHARACTER SET charset_name;
```
例子：

```
mysql> CREATE DATABASE db1
-> CHARACTER SET utf8;
```
使用数据库db1

```
mysql> USE db1;
```
删除db1

```
mysql> DROP DATABASE db1;
```
查看系统中已有的数据库

```
mysql> show databases;
```
创建新用户

```
mysql> use mysql;
mysql> GRANT ALL ON db1.* to dbuser1 IDENTIFIED BY '123';
```
出错后这样解决  
ERROR 1290 (HY000): The MySQL server is running with the --skip-grant-tables option so it cannot execute this statement
mysql> flush privileges;  
Query OK, 0 rows affected (0.00 sec)  

```
mysql> GRANT ALL ON db1.* to dbuser1 IDENTIFIED BY '123';   //*表示这个用户对于这个数据库的一切对象都有权限
```
Query OK, 0 rows affected, 1 warning (0.00 sec)

登陆dbuser1后

```shell
# mysql -u dbuser1 –p
```
设置字符集

```shell
mysql> SET NAMES utf8;
```
字符集一定要统一  
字符集一定要统一  
字符集一定要统一  
字符集  
1.  首先操作系统的字符集为utf8
查看操作系统字符集命令
locale
2.  创建数据库的时候使用CHARACTER SET utf8;指定字符集为utf8
3.  设置mysql client字符集
SET NAMES utf8;
4.  CRT设置为utf8
要注意的是注意大小写问题


Sql语言
===


创建表语句
---
```c
CREATE TABLE TABLENAME (COL_NAME1 TYPE, COL_NAME2 TYPE……);
```
常用type说明
INT                整数
CHAR(LENGTH)       定长字符串，短语指定长度用空格填充
VARCHAR(LENGTH)    可变长字符串


删除表语句
---
```c
DROP TABLE TABLENAME;
```
例子：

```
mysql> use db1;
Database changed
mysql> CREATE TABLE table1 (name varchar(100), sex varchar(10), age int, class varchar(100));
mysql> show tables;
+---------------+
| Tables_in_db1 |
+---------------+
| table1        |
+---------------+
创建带id号的表
mysql> CREATE TABLE table2 (ID int(11) NOT NULL auto_increment, name varchar(100), age int, PRIMARY KEY(ID));
```


查看表的结构
---
```
mysql> desc table1;
```


插入数据语句
---
```shell
mysql> INSERT INTO TABLENAME (COL1, COL2,…) VALUES(VAL1, VAL2…);
```
向表插入一行数据，前面指定列名，后面插入的值  
注意在sql语句中字符串用单引号  
带ID的表，ID自动，不需要管

```
mysql> INSERT INTO table2 (name, age) VALUES ('里斯', 20);
```
<a href="http://wx3.sinaimg.cn/mw690/af2d2659gy1fdulf8l08sj20hl0guadb.jpg" data-lightbox="roadtrip">
<img src="http://wx3.sinaimg.cn/mw690/af2d2659gy1fdulf8l08sj20hl0guadb.jpg" class="img-fluid">
</a>


SELECT语句
---
```sql
SELECT * FROM table1;
SELECT name, age FROM table1;
```
返回指定行数的SELECT查询数据语句  
LIMIT字句的语法  
```sql
SELECT * FROM TABLENAME LIMIT m,n
```
其中m是指记录开始的index,从0开始，表示第一条记录  
N是指从第m+1条开始，取n条  
例子：  

```sql
SELECT * FROM table1 LIMIT 0,5
SELECT * FROM table1 LIMIT 6,3
```

带有条件的查询语句

```sql
SELECT COL1,COL2,… FROM TABLENAME WHERE CONDITIONAL;
```
WHERE后面是条件语句  
条件语句可以做逻辑判断组合  
LIKE 通过%通配符匹配指定模式  
IN 包含子集  
<> 不等于  
例子：

```
mysql> SELECT * FROM table1 WHERE age >= 20;
mysql> SELECT * FROM table1 WHERE age >= 20 AND class = '高数';
mysql> SELECT * FROM table1 WHERE class LIKE '高%'; 
mysql> SELECT * FROM table1 WHERE age IN (20, 30);
```


别名
---

列别名

```sql
SELECT FIELDNAME ALIAS FROM TABLENAME;
```
表别名

```sql
SELECT ALIAS.FIELDNAME FROM TABLENAME ALIAS;
```
例子：

```sql
mysql> SELECT name 姓名 FROM table2;
```


聚合函数
---

SUM([DISTINCT] FIELDNAME)  
求指定列之和  
MAX([DISTINCT] FIELDNAME)  
求指定列最大值  
MIN([DISTINCT] FIELDNAME)  
求指定列最小值  
COUNT([DISTINCT] FIELDNAME)  
求指定列记录总数  
AVG([DISTINCT] FIELDNAME)  
求指定列平均值  
distinct 过滤重复的值  
例子：

```
mysql> SELECT SUM(age) FROM table2;
mysql> SELECT name FROM table2 WHERE age = (SELECT MAX(age) FROM table2);
mysql> SELECT SUM(DISTINCT age) FROM table2;
mysql> SELECT COUNT(DISTINCT age) FROM table2;
mysql> SELECT COUNT(name) FROM table2 WHERE name LIKE '里%';
```
GROUP BY子句
将查询的结果根据指定字段分组；
GROUP BY fieldname [DESC]
往往和聚合函数配合使用
ORDER BY子句
将查询结果根据指定字段排序
ORDER BY fieldname [DESC]
例子：

```
mysql> SELECT COUNT(name) FROM table2 GROUP BY name;
mysql> SELECT MAX(age) FROM table2 GROUP BY name;
```
每个组单独用这个聚合函数

```
mysql> SELECT * FROM table2 ORDER BY age;
mysql> SELECT * FROM table2 ORDER BY age DESC;反过来
```


SELECT 语句，查询多个表的WHERE语句
---
```sql
SELECT * FROM table1, table2 WHERE table1.AGE = table2.AGE;
SELECT * FROM table1, table2 WHERE (table1.NAME = table2.NAME) AND table1.AGE = 20;
```


CREATE INDEX语句用于在表中创建索引
---

在不读取整个表的情况下，索引可以是数据库应用程序更快地查找数据。  
CREATE INDEX语法  
在表上创建一个简单的索引。允许使用重复的值  
CREATE INDEX index_name  
ON table_name (column_name)  
CREATE UNIQUE INDEX语法  
在表上创建一个唯一的索引。不允许使用重复的值  
CREATE UNIQUE INDEX index_name  
ON table_name (column_name)  
例子：

```
mysql> CREATE INDEX table1_age ON table1 (age);
```
建立表的时候PRIMARY KEY (ID))语句相当于为ID字段建立了一个唯一索引



积累
===

tar xvf 解压缩包  
tar cvf 打包命令  
查看操作系统字符集命令  
locale

deb 是 ubuntu 、debian 的格式。 rpm 是 redhat 、fedora 、suse 的格式。  
他们不通用（虽然可以转换一下）。  
deb是debian发行版的软件包 ubuntu是基于debian 发行的 所有可以用  
.deb是solaris系统下的安装包后缀名。安装方法如下  
cd 到安装包的目录  
dpkg -i 安装包名字  
如果你使用的是red hat linux，然后运行以下命令安装  
cd 到安装包的目录 rpm -ivh 安装包名字  

查看安装的文件  
rpm -qa | grep 文件

卸载  
rpm -e 文件  
强制卸载  
rpm -e --nodeps 文件

